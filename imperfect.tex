In this chapter we generalize our problem to allow for partitioning $C$ into parts
that are not necessarily clone sets.
We then measure how much such a partition differs from a decloning.
For given preference profile we try to find a partition that minimizes this value.

\section{General Problem}

The problem of \textsc{Decloning} turned out to be simple in the sense of $P$ vs. $NP$-hard.
We may suppose that it is caused by too tight requirements imposed on a part of candidate set partition,
namely it being a clone set.
Now we drop this restriction and instead measure how different in some sense a part is from some clone set.
Of course, we require that this measure equals $0$ only for clone sets.

\begin{defn}[clone set error function]
Given a preference profile $P$ over $C$ we say that a function
$f: 2^C \setminus \{\emptyset\} \rightarrow \mathbb{R}_+\cup\{0\}$
is a clone set error function for $P$ when $f(X) = 0$ iff $X$ is a clone set for $P$.
\end{defn}

Now we can generalize the \textsc{Decloning} problem into \textsc{OptimalDecloning}
where we try to minimize the sum of errors of parts of candidate set partition.


\begin{problem}{OptimalDecloning}
% TODO: function f as a polynomial circuit
	Input: Preference profile $P$ over $C$, clone set error function $f$,
		integer $k$, positive real number $l$.

	Question: Is there a partition of $C$ into $C_1, ..., C_k$ such that $\sum_{i=1}^k f(C_i) \leq l$?
\end{problem}

\begin{thm} \label{optdecl}
	\textsc{OptimalDecloning} is $NP$-complete.
\end{thm}

\begin{lmm} \label{lmmnotrivial}
	Preference profle $P = (\succ_1, ... , \succ_m)$ over $C = \{1, ..., n\}$
	where for each $i=1,...,m$ we have
	$$i \succ_i i+1 \succ_i ... \succ_i n \succ_i 1 \succ_i 2 \succ_i ... \succ_i i-1$$
	has no non-trivial clone sets.
\end{lmm}

\begin{proof}[Proof by contradiction]
Let us consider a non-trivial clone set $X$ for $P$.
It is a contiguous subsequence of preference order $\succ_1$, so $X = \{i,...,j\}$ for some $i,j \in C$.
Clone set $X$ is not trivial, so both $i\neq{j}$ and $X\neq{C}$.
Let us notice that $X$ is not contiguous on the preference order $\succ_{i+1}$.
Subset $X$ is thus not a clone set for $P$.
\end{proof}

\begin{proof}[Proof of theorem \ref{optdecl}]
We will show a reduction from the \textsc{X3C} problem.

We are given set $X$, collection $S$ and integer $n$.
Let us take clone set $C = X$ and function $f:2^C\rightarrow \{0,1,n+1\}$ such that:
$$ f(X) =
\begin{cases}
0, &\text{when} \abs{X} \in \{1,3n\} \\
1, &\text{when} X \in S \\
n+1, &\text{in other cases}
\end{cases}
$$
Function $f$ is well-defined when $n>1$, because if $X \in S$ then $\abs{X} = 3 \not\in \{1,3n\}$.
Condition $n=1$ can be special-cased during the runtime of reduction.
Let us take preference profile $P$ over $C$ as in lemma \ref{lmmnotrivial}.
Function $f$ is a clone set error function for $P$, because $f(X) = 0$ iff $X$ is a trivial clone set
and preference profile $P$ has no non-trivial clone sets.
Let us take $l=k=n$, what gives us all the inputs necessary for \textsc{OptimalDecloning} problem.
Let us check when the answer to this problem is \textsc{yes}.

No part $X$ of the partition of $C$ can have $f(X)=n+1$, as it itself exceeds limit $l$.
This means that every part $X$ either belongs to $S$ or has $\abs{X} \in \{1,3n\}$.
In both cases $\abs{X} \in \{1,3,3n\}$.
When $n>1$ we cannot use $3n$-sized parts,
as it yields only one part in partition while $k>1$.

We are left with $\abs{X} \in \{1,3\}$.
Let us note that due to the specified size $k=n$ of partition and $\abs{C} = 3n$
the partition can contain only three-element parts.
This means that we may choose $X$ only from $S$.
It is possible to construct a valid partition only when there is an $A \subset S$ satisfying the \textsc{X3C} problem.

In that case we have partition $A$ of candidate set $C$ such that
$$ \sum_{X \in A} f(X) = \sum_{X \in A} 1 = n,$$
so the answer to \textsc{OptimalDecloning} problem is \textsc{yes}
iff the answer to \textsc{X3C} is~\textsc{yes}.
\end{proof}



\section{Specific Error Functions}

Let us try to fix a value of error function input to \textsc{OptimalDecloning} problem
treating it as if it was hardcoded into the specification of the new problem.

% good error function discussion

\subsection{Component error function}

% intuition for f_com

To formulate the definition of component error function we will need a definition of kernel of total order relation.

Given a total order $\succ$ over a finite set we may sort its elements into a sequence
such that for every pair of elements former is in the relation $\succ$ with the latter.
This sequence naturally induces another relation, namely relation $\overline{\succ}$
between every two consecutive elements.
We will call such a relation a kernel of $\overline{\succ}$.
It is easy to recover $\succ$ from $\overline{\succ}$ simply by taking the transitive closure of $\succ$.

\begin{defn}[kernel of total order]
Given a total order $\succ$ over a finite set we say that $\overline{\succ}$ is its kernel when
$\overline{\succ}$ is a minimal relation whose transitive closure equals $\succ$.
\end{defn}

\begin{exmp}
Kernel of natural order $>$ over set $\{1,2,3,4\}$ is the relation
$\overline{>} = \{(4,3), (3,2), (2,1)\}$.
\end{exmp}

\begin{defn}[component error function]
Let us define for given preference profile $P = (\succ_1, ..., \succ_m)$ over candidate set $C$
a function $f_{com}: 2^C \rightarrow \mathbb{N}_0$ with the following formula:
$$ f_{com}(X) = \sum_{i=1}^m \left( \abs{X}-1 -
\abs{\left\lbrace \left( a,b \right) \in X^2 : a \overline{\succ}_i b \right\rbrace }
\right) \text{.}$$
\end{defn}

\begin{rmrk}
Function $f_{com}$ for preference profile $P$ is a clone set error function for $P$.
\end{rmrk}

\begin{problem}{ComponentOptimalDecloning (COD)}
	Input: Preference profile $P$ over $C$, integers $k$ and $l$.

	Question: Given than $f_{com}$ is a component error function for $P$,
		is there a partition of $C$ into $C_1, ..., C_k$ such that $\sum_{i=1}^k f_{com}(C_i) \leq l$?
\end{problem}

Given a preference profile $P = (\succ_1, ..., \succ_m)$ let us create now a multigraph $G=(C,E)$
where $E$ is a multiset obtained by multisum
of each $\{a,b\}$ such that $a,b \in P$ and $a \overline{\succ} b$ for some $\succ \in P$.
We get a multigraph created from Hamiltonian path of each voter's preferences.
Let us call this a Hamiltonian path multigraph.

\begin{defn}[Hamiltonian path multigraph]
A multigraph $G=(V,E)$ is a Hamiltonian path multigraph if there exists a partition of $E$
into sets of edges of Hamiltonian paths in $G$.
\end{defn}

Partitioning $C$ into $C_1,...,C_k$ corresponds to
partitioning Hamiltonian path multigraph $G$ into submultigraphs $G_1,...,G_k$
% necessary induced graphs? maybe just partition of V?
induced by $C_1,...,C_k$ respectively.
Let us denote by $c_{ij}$ part
$\abs{\left\lbrace \left( a,b \right) \in C_i^2 : a \overline{\succ}_j b \right\rbrace }$
of the formula of $f_{com}(C_i)$ such that
$f_{com}(C_i) = \sum_{j=1}^m \left( \abs{C_i} - 1 - c_{ij} \right)$.
We have that $c_{ij}$ is the number of edges from $j$-th voter's Hamiltonian path
that connects two vertices from $C_i$.
We will call such edges the $C_i$ intra-part edges and edges that end in different parts the inter-part edges.

Now the error value equals:
$$
\sum_{i=1}^k f_{com}(C_i) =
\sum_{i=1}^k \sum_{j=1}^m \left( \abs{C_i} - 1 - c_{ij} \right) =
m \sum_{i=1}^k \abs{C_i} - m k - \sum_{i=1}^k \sum_{j=1}^m c_{ij} =
m(n-k) - \sum_{j=i}^m \sum_{i=1}^k c_{ij}
\text{.}$$

Let us note that $\sum_{i=1}^k c_{ij}$ is the total number of $C_i$ intra-part edges
and $\sum_{j=i}^m \sum_{i=1}^k c_{ij}$ is the total number of intra-part edges.
As value of $m(n-k)$ is constant for a given graph,
we have that \textsc{ComponentOptimalDecloning} is essentially a problem of maximizing the number of intra-part edges.
We will that number a score of partition.

\begin{defn}[partition score]
Given a multigraph $G=(V,E)$, $E=(V,e)$ and a partition $(V_1, ..., V_k)$ of $V$
we say that a score of part $V_i$ for $i=1,...,k$ equals $\sum_{u,v \in V_i} e(\{u,v\})$.
We say that a partition score is a sum of the scores of its parts.
\end{defn}

\begin{rmrk}
Score of a part that is a singleton equals $0$.
\end{rmrk}

This lets us to formulate another problem which is equivalent to \textsc{ComponentOptimalDecloning}
in terms of reduction.

\begin{problem}{HamiltonianPathMultigraphPartition (HPMP)}
	Input: Hamiltonian path multigraph $G=(V,E)$
		together with its partition into Hamiltonian paths, integers $k$ and $s$.

	Question: Is there a $k$-sized partition of $V$ of score at least $s$?
\end{problem}

\begin{rmrk}
There is a reduction of problem \textsc{HPMP} to \textsc{COD}.
\end{rmrk}

\begin{thm} \label{ultimate-theorem}
\textsc{ComponentOptimalDecloning} is $NP$-complete.
\end{thm}

\begin{lmm} \label{hpmd-red}
For every graph $G=(V,E)$ and hamiltonian path multigraph $G=(V',E')$, $E=(V',w)$ such that $V' \supset V$ and
$$ w(\{u,v\}) =
\begin{cases}
2, &\text{when} \{u,v\} \in E \\
0, &\text{when} \{u,v\} \not\in E, u,v \in V \\
<= 1, &\text{when} u \not\in V \vee v \not\in V
\end{cases}
$$
there is a clique of size $c$ in $G$ iff
there is $\left(\abs{V'}-c-1\right)$-sized partition of $V'$ of score $c(c-1)$.
\end{lmm}

\begin{proof} \label{hpmp-red-2}
Let us consider any graphs $G=(V,E)$ and $G'=(V',(V',w))$ satisfying the condition of the lemma.
If there is a $c$-sized clique $C \subset V$ in $G$,
then we may partition $V'$ into $C$ and singletons for each $u \in V' \setminus C$.
As $f(\{u,v\})=2$ for $u,v \in C$, such a partition has score $2 {c(c-1) \over 2} = c(c-1)$.
This proves the implication in one direction.

Now let us study the case when there is no $c$-sized clique in $G$.
Let us consider any partition $P$ of $V'$, $P=(V_1, ..., V_k)$ for $k = \abs{V'}-c-1$.
Partition $P$ cannot contain any part bigger than $c$,
because all of the parts need to be nonempty.
If $P$ contains $c$-sized part $V_1$ included entirely in $V$, then its score is less than $c(c-1)$,
for $V$ does not contain $c$-sized cliques.
In other case part $V_1$ contains a vertex from $V' \setminus V$.
This means that there is an edge $e$ ended in $V_1$ such $w(e)<=1$, so the score of $P$ is less that $c(c-1)$.

The only case left is when each part of $P$ has size less than $c$.
We will do reasoning similar to the one in the proof of theorem \ref{gp-np}.
Let us denote the upper bound of the score $m$-sized part of $f(m)$, $f(m) = m(m-1)$.
Function $f$ is strictly convex because $f'' = 2 > 0$
and sequence $(c,1,...,1)$ majorizes sequence $S$ of sizes, so we can use inequality \ref{thm:Kar}
for $f$ and both sequence.
This gives us the following upper limit on score $q$ of $P$:
$$q <= \sum_{s \in S} f(s) < f(c) + f(1) + ... + f(1) = c(c-1) \text{.}$$
So also in this case the score of $P$ is less than $c(c-1)$ and the lemma is proved.
\end{proof}

\begin{lmm}
Given a graph $G$ and integer $c$ there is a polynomial-time construction
of hamiltonian path multigraph $G'$ together with its path decomposition
satisfying the conditions of lemma \ref{hpmd-red}.
\end{lmm}

\begin{proof}
\end{proof}

\begin{proof}[Proof of theorem \ref{ultimate-theorem}.]
We will show a reduction from \textsc{Clique} problem to \textsc{HPMP}.
We are given graph $G$ and integer $c$
Lemma \ref{hpmp-red-2} shows a polynomial-time construction of multigraph $G'$.
Let us take $k=\abs{V'}-c-1$ and $s=c(c-1)$.
Lemma \ref{hpmd-red} proves that it is a valid reduction, i.e. it preserves the answer.
So \textsc{HPMP} problem is $NP$-complete.
\end{proof}

\subsection{Inconsistent voters error function}